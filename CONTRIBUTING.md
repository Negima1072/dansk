## 開発者向けドキュメント

### ディレクトリ構造

<pre>
.
├── .husky Huskyの設定フォルダ
├── .output ビルド成果物の出力先
├── public 静的なファイルの保管 ビルド時にdistにコピーされる
└── src ソースコード保管フォルダ
    ├── __tests__ vitestのテストファイル
    ├── components 各コンポーネントを格納 CSSを含むものはフォルダに入れてまとめる
    |   ├── common 一般的なコンポーネント
    |   ├── footers プレイヤー外下に表示されるブロック
    |   ├── headers プレイヤー外上に表示されるブロック
    |   ├── layer 動画上に表示されるレイヤー
    |   ├── main プレイヤー下に表示されるブロック
    |   ├── memo メモ機能
    |   └── options 設定機能
    ├── entrypoints WXTで利用するエントリーポイント
    |   └── popup ポップアップの実装
    ├── hooks Reactのフック
    ├── libraries 便利ツールとか
    └── types 型定義ファイル用
</pre>

### TS の書き方

#### Null/Undefined の取り扱い

TypeGuard(src/libraries/typeGuard.ts)を使うか、if で確認をする
!で握りつぶすと lint に怒られるので注意

#### 型キャスト

`<type>hoge`とすると JSX と混同するため型をキャストするときは`hoge as type`でキャスト

#### import

ライブラリの import は`外部ライブラリ`、`Path Alias`、`相対パス`でグループ分け

#### 拡張子

React(JSX)を含むものは tsx に、それ以外は ts にする

#### データ

データを保管する場合は ts ファイルで変数に型付きで定義して、export する
JSON は型定義ができないので使用しない

### リリース

#### リリース前に確認すべきこと

- [ ] ビルドが行えること(lint や test でエラーが出ない)
- [ ] 読込時にエラーが発生しないこと
- [ ] レイヤーを作成できること（複数のサイズのレイヤーを作成すること）
- [ ] レイヤー内でレイヤーの内容通りのサイズや色で文字入力ができること（改行を含む）
- [ ] レイヤーの文字色を変えられること（意図していないレイヤーの色が変わらないこと）
- [ ] レイヤーの並び順を変えて意図した順番で表示され、他のレイヤーに意図しない変更が入らないこと
- [ ] レイヤーの削除が行えること（削除後に他のレイヤーに問題が起きないこと）
- [ ] 出力が行えること（全出力・等幅出力など）
- [ ] レイヤーの保存機能が正常に使用でき、ファイル出力が行えること
- [ ] レイヤーの読込機能が正常に使用でき、ファイル復元が行えること
- [ ] 背景画像の読込が行えること、表示/非表示が切り替えられること
- [ ] コマンド変更が行えること
- [ ] 自動投下が行えること
- [ ] 時間移動スクリプトが動作すること

#### リリースの仕方

1. main ブランチに PullRequest を出しマージする
2. main ブランチ宛にバージョン名の変更,`CHANGELOG.md`の変更を push する。
3. main ブランチで release コミットにバージョン名(vx.x.x)のタグを push する
4. Release Action が自動で実行される
   - Chrome Web Store への提出
   - xpi ファイルの署名
   - リリースの作成
   - Discord に告知
5. X(Twitter) で告知を行う

#### バージョンの付け方

`x.y.z`形式でバージョンを決定する。更新する箇所は下記の通り。

- `x`: **メジャーバージョン** 大規模アップデートへの対応など大きな改善・修正の場合
- `y`: **マイナーバージョン** 機能追加が含まれる場合
- `z`: **パッチバージョン** バグ修正など軽微な修正のみの場合
